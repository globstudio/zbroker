<class
    name = "zpipes_msg"
    signature = "0"
    title = "ZPIPES protocol"
    script = "zproto_codec_c"
    header = "../include"
    source = "."
    >
    This is a codec for the ZPIPES protocol (RFC tbd)
    <include filename = "license.xml" />

    <grammar>
    ZPIPES = reader | writer

    reader = input-command *fetch-command close-command
    input-command = c:input ( s:ready | s:failed )
    fetch-command = c:fetch ( s:fetched | s:empty | s:timeout | s:failed )
    close-command = c:close ( s:closed | s:failed )

    writer = output-command *store-command close-command
    output = c:output ( s:ready | s:failed )
    store = c:store ( s:stored | s:failed )
    </grammar>

    <message name = "input">
        Create a new pipe for reading
        <field name = "pipename" type = "string">Name of pipe</field>
    </message>

    <message name = "output">
        Create a new pipe for writing
        <field name = "pipename" type = "string">Name of pipe</field>
    </message>

    <message name = "ready">
        Input or output request was successful
    </message>

    <message name = "failed">
        Input or output request failed
        <field name = "reason" type = "string">Reason for failure</field>
    </message>
    
    <message name = "fetch">
        Read next chunk of data from pipe
        <field name = "timeout" type = "number" size = "4">Timeout, msecs, or zero</field>
    </message>

    <message name = "fetched">
        Have data from pipe
        <field name = "chunk" type = "chunk">Chunk of data</field>
    </message>

    <message name = "empty">
        Pipe is closed, no more data
    </message>

    <message name = "timeout">
        Get or put ended with timeout
    </message>

    <message name = "store">
        Write chunk of data to pipe
        <field name = "chunk" type = "chunk">Chunk of data</field>
    </message>

    <message name = "stored">
        Store was successful
    </message>

    <message name = "close">
        Close pipe
    </message>

    <message name = "closed">
        Close was successful
    </message>
</class>
